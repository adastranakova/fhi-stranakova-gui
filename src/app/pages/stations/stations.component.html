<div class="container">
  <app-page-title title="Stations"></app-page-title>

  <app-card>
    @if (loading()) {
      <app-loader></app-loader>
    } @else {
      <table class="table">
        <thead>
        <tr>
          <th>Station Name</th>
          <th>Address</th>
          <th>Total Slots</th>
          <th>Available Bikes</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
          @for (station of stations(); track station.name) {
            <tr>
              <td>{{ station.name }}</td>
              <td>{{ station.address }}</td>
              <td>{{ station.numberOfSlots }}</td>
              <td>{{ station.availableBikes }} bikes</td>
              <td>
                <button class="btn btn-sm btn-info me-1" (click)="openManageBikes(station.name)">
                  <i class="bi bi-bicycle"></i> Manage Bikes
                </button>
                <button class="btn btn-sm btn-warning me-1" (click)="editStation(station.name)">
                  <i class="bi bi-pencil"></i> Edit
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteStation(station.name)">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <div class="row justify-content-end mt-3">
        <div class="col-auto">
          <button class="btn btn-primary" routerLink="/stations/create">
            <i class="bi bi-plus"></i> Add Station
          </button>
        </div>
      </div>
    }
  </app-card>
</div>

<!-- Modal for managing bikes -->
@if (showModal()) {
  <div class="modal" (click)="closeModal()">
    <div class="modal-dialog modal-lg" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Manage Bikes - {{ selectedStation() }}</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <h6>Slots:</h6>
          @for (slot of modalSlots(); track slot.slotNumber) {
            <div class="slot-item" [ngClass]="slot.isEmpty ? 'slot-empty' : 'slot-occupied'">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>Slot {{ slot.slotNumber }}:</strong>
                  @if (slot.isEmpty) {
                    <span class="text-muted ms-2">Empty</span>
                  } @else {
                    <span class="text-success ms-2">{{ slot.bikeId }}</span>
                  }
                </div>
                <div>
                  @if (slot.isEmpty) {
                    <button class="btn btn-sm btn-primary" (click)="addBikeToSlot(slot.slotNumber)">
                      <i class="bi bi-plus"></i> Add Bike
                    </button>
                  } @else {
                    <button class="btn btn-sm btn-warning" (click)="unlockBikeFromSlot(slot.slotNumber)">
                      <i class="bi bi-unlock"></i> Unlock
                    </button>
                  }
                </div>
              </div>
            </div>
          }
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
}
